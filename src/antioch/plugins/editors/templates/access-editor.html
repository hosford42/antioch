{% extends 'base.html' %}

{% block header %}
<link href="{{ STATIC_URL }}less/access-editor.less" type="text/css" media="screen" rel="stylesheet/less" />
<script type="text/javascript" src="{{ STATIC_URL }}js/client.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/editor-plugin.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/access-editor.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/less-1.3.0.min.js"></script>
{% endblock %}

{% block content %}
<form id="access-form" method="POST" action="">
	{% csrf_token %}
	<div id="editor">
		<button class="btn" id="add-button"><span class="icon-plus-sign"></span> add rule</button>
	</div>
	<div class="controls form-actions">
		<button type="submit" id="save-button" class="action-button btn btn-primary">Save changes</button>
		<button type="button" class="btn">Cancel</button>
	</div>
</form>
{% endblock %}

{% block footer %}
<script type="text/javascript">
$(document).ready(function(){
	$(document).antioch();
	
	$('#editor').sortable({
		handle:	".drag-thumb",
		items: 	".access-rule",  
	})

	$('#add-button').click(function(){
		addRule({
			access_id	: 0,
			access		: "group",
			accessor	: "",
			rule		: "allow",
			permission	: "anything",
		});
	});
	
	{% for access in model.acl.all %}
	addRule({access_id: {{ access.id }}, rule: "{{ access.rule }}", access: "{{ access.type }}", accessor: "{% if access.type == 'accessor' %}{{ access.accessor }}{% else %}{{ access.group }}{% endif %}", permission: "{{ access.permission }}", weight: {{ access.weight }}});
	{% endfor %}
	
	$('#access-form').submit(saveAccess);
});
</script>
{% endblock %}
