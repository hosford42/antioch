{% extends 'trivial.html' %}
{% load widget_tweaks %}
{% load staticfiles %}

{% block header %}
<link rel="stylesheet/less" type="text/css" href="{% static 'less/access-editor.less' %}" />
{% endblock %}

{% block content %}
<div class="modal-content">
  <form id="access-form" method="POST" action="">
    {% csrf_token %}
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h4 class="modal-title" id="editorFormLabel">Edit {{ form.instance }}</h4>
    </div>
    <div class="modal-body access editor">
      <button class="btn" id="add-button"><span class="icon-plus-sign"></span> add rule</button>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
      <button type="submit" class="btn btn-primary">Save changes</button>
    </div>
  </form>
</div>
{% endblock %}

{% block footer %}
<script type="text/javascript" src="{% static 'js/access-editor.js' %}"></script>
<script type="text/javascript">
$(document).ready(function(){
	$(document).antioch();
	
	$('#editor').sortable({
		handle:	".drag-thumb",
		items: 	".access-rule",  
	})

	$('#add-button').click(function(){
		addRule({
			access_id	: 0,
			access		: "group",
			accessor	: "",
			rule		: "allow",
			permission	: "anything",
		});
	});
	
	{% for access in model.acl.all %}
	addRule({access_id: {{ access.id }}, rule: "{{ access.rule }}", access: "{{ access.type }}", accessor: "{% if access.type == 'accessor' %}{{ access.accessor }}{% else %}{{ access.group }}{% endif %}", permission: "{{ access.permission }}", weight: {{ access.weight }}});
	{% endfor %}
	
	$('#access-form').submit(saveAccess);
});
</script>
{% endblock %}
